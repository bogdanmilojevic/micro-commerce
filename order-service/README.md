# Order Service

## Overview

Order service is a microservice responsible for managing orders including creating new orders, updating existing order, retrieving and deleting orders.
Project uses Postgres database and confluent Kafka broker image.

## Kafka Configuration

- Kafka ProducerFactory and KafkaTemplate are configured using Java configuration classes present in `com.microcommerce.orderservice.config` package.
- Kafka topic ('notification-topic' for now) is configured using Java configuration class as well.\:
```java
@Configuration
public class KafkaTopicConfiguration {

    @Bean
    public NewTopic notificationTopic() {
        return TopicBuilder.name("notification-topic")
                .partitions(2)
                .replicas(1)
                .build();
    }
}
```

## Order Creation Process

1. POST /api/order endpoint is called
2. OrderRequest constraints are validated
3. Product Service is called via feign client in order to validate order items are in stock
4. Order number is generated by combining first 5 charters of random UUID with current date
5. Order entity is persisted to the database
6. OrderCreatedEvent is published

### OrderCreatedEvent

**Topic:** notification-topic<br>

```java
public class OrderCreatedEvent {
    private String orderNumber;
    private List<EventOrderItemDto> orderItems;
    private UUID userId;
    // TODO: Add field User(uuid, email, firstName, lastName)
}
```

- Event produced by order service once new order is placed successfully.
- KafkaProducer for OrderCreatedEvent is configured via Java file which can be found in `com.microcommerce.orderservice.config` package

## Further Development
- Reconsider 'notification-topic' kafka topic name.
- Logging and monitoring should be implemented.
- Endpoints for retrieving, updating and deleting orders should be implemented.
- Implementation of order status should be considered.
- Order number generation logic should be revisited.
- Available product stock should be updated after order placement.
- ProductLowInStock event should be published by order service (or product-service?) if product stock falls below certain threshold.
- Consider replacing REST API with RPC for inner-process communication.